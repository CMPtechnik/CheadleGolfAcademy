<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cheadle Juniors ‚Äì Results History</title>

<link rel="icon" href="favicon.png" type="image/png">
<link rel="apple-touch-icon" href="favicon.png" sizes="180x180">
<meta name="theme-color" content="#00c896" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
/* ================= DESIGN SYSTEM (MATCHES INDEX) ================= */
:root{
  --primary:#00c896;
  --primary-dark:#008f6a;
  --accent:#eafff8;
  --text:#0f172a;
  --bg:#f8fafc;
  --card:#ffffff;
  --border:rgba(0,0,0,0.08);
  --hover:rgba(0,0,0,0.04);
  --radius:14px;

  --shadow-1:0 10px 25px rgba(0,0,0,0.08);
  --shadow-2:0 20px 40px rgba(0,0,0,0.10);
}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Inter","Segoe UI",sans-serif;
  background:
    radial-gradient(1200px 600px at 10% -10%, #d1fae5, transparent),
    radial-gradient(800px 400px at 90% 10%, #ccfbf1, transparent),
    var(--bg);
  color:var(--text);
}

/* ================= HEADER ================= */
header{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  padding:1.4rem 1rem 2rem;
  text-align:center;
  border-bottom-left-radius:24px;
  border-bottom-right-radius:24px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
}

header h1{
  margin:0.25rem 0 0;
  font-size:1.6rem;
  font-weight:900;
}

.header-sub{
  margin-top:0.35rem;
  font-weight:700;
  opacity:0.9;
}

/* ================= NAV ================= */
.nav{
  margin-top:-1.1rem;
  display:flex;
  justify-content:center;
  gap:0.75rem;
  flex-wrap:wrap;
}

.nav a{
  background:var(--card);
  color:var(--text);
  padding:0.55rem 0.9rem;
  border-radius:999px;
  text-decoration:none;
  font-weight:900;
  box-shadow:var(--shadow-1);
  border:1px solid var(--border);
}

/* ================= SEASON SELECT ================= */
#seasonFilterContainer{
  margin:1.2rem auto 0.5rem;
  text-align:center;
}

#seasonFilter{
  padding:0.6rem 1rem;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--card);
  font-weight:800;
}

/* ================= MAIN ================= */
main{
  max-width:1100px;
  margin:auto;
  padding:1rem;
}

/* ================= SECTIONS ================= */
section{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow-2);
  border:1px solid var(--border);
  padding:1rem;
  margin-bottom:1.5rem;
  position:relative;
}

/* ================= TABLE ================= */
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  margin-top:0.5rem;
}

th,td{
  padding:12px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

th{
  background:var(--accent);
  text-transform:uppercase;
  font-size:0.75rem;
  letter-spacing:0.05em;
}

tbody tr:hover{
  background:var(--hover);
}

/* ================= PRINT ================= */
.print-btn{
  position:absolute;
  top:0.75rem;
  right:0.75rem;
  padding:0.4rem 0.8rem;
  border:none;
  border-radius:999px;
  background:var(--primary);
  color:#fff;
  font-weight:900;
  cursor:pointer;
}

.logo,.print-domain{display:none;}

@media print{
  body *{visibility:hidden!important;}
  .print-target,.print-target *{visibility:visible!important;}
  .print-btn{display:none!important;}
  .logo{display:block!important;max-width:260px;margin:0 auto 0.5rem;}
  .print-domain{display:block!important;text-align:center;margin-bottom:1rem;}
  @page{margin:1cm;}
}

/* ================= MOBILE ================= */
@media(max-width:768px){
  table{display:block;overflow-x:auto;white-space:nowrap;}
}
</style>
</head>

<body>

<header>
  <div class="nav">
    <a href="index.html">üè† Home</a>
    <a href="#">üìä Results</a>
  </div>
  <h1>Results History</h1>
  <div class="header-sub">‚¨ÖÔ∏è‚û°Ô∏è Scroll to view full table</div>
</header>

<div id="seasonFilterContainer">
  <label><strong>Season</strong></label><br>
  <select id="seasonFilter"></select>
</div>

<main id="content">
  <!-- Results injected here -->
</main>

<script>
/* ================= ORIGINAL LOGIC (UNCHANGED) ================= */

function parseDateStr(s){
  if(!s) return new Date('Invalid');
  if(typeof s==='number') return new Date(Math.round((s-25569)*86400*1000));
  if(typeof s==='string'&&s.includes('/')){
    const p=s.split('/');
    return new Date(p[2],p[1]-1,p[0]);
  }
  const d=new Date(s);
  return isNaN(d)?new Date('Invalid'):d;
}

let allCompetitions=[];
let currentSeason=null;

fetch('https://raw.githubusercontent.com/CMPtechnik/cheadlegolfacademy/main/data/leaguedata.xlsx?v='+Date.now())
.then(r=>r.arrayBuffer())
.then(buf=>{
  const wb=XLSX.read(buf,{type:'array'});

  const settings=wb.Sheets['Settings'];
  if(settings){
    XLSX.utils.sheet_to_json(settings,{header:1}).forEach(r=>{
      if(r[0]&&r[0].toString().toLowerCase().includes('current season')){
        currentSeason=r[1];
      }
    });
  }

  const sheet=wb.Sheets[wb.SheetNames[0]];
  const rows=XLSX.utils.sheet_to_json(sheet);
  allCompetitions=rows;

  const years=[...new Set(rows.map(r=>parseDateStr(r.Date).getFullYear()))].sort((a,b)=>b-a);
  const dd=document.getElementById('seasonFilter');
  years.forEach(y=>{
    const o=document.createElement('option');
    o.value=y;o.textContent=y;
    dd.appendChild(o);
  });

  const thisYear = new Date().getFullYear();

  const defaultYear =
    years.includes(thisYear) ? thisYear :
    (currentSeason && years.includes(parseInt(currentSeason))) ? parseInt(currentSeason) :
    years[0];

  dd.value = defaultYear;
  renderSeason(defaultYear);

  dd.onchange=e=>renderSeason(e.target.value);
});

function renderSeason(year){
  const c=document.getElementById('content');
  c.innerHTML='';
  const data=allCompetitions.filter(r=>parseDateStr(r.Date).getFullYear()==year);

  if(!data.length){
    c.innerHTML=`<p style="text-align:center;">No results for ${year}</p>`;
    return;
  }

  const groups={};
  data.forEach(r=>{
    const k=r.Title||r.Competition||'Unknown';
    (groups[k]=groups[k]||[]).push(r);
  });

  Object.keys(groups).sort((a,b)=>parseDateStr(groups[b][0].Date)-parseDateStr(groups[a][0].Date))
  .forEach(title=>{
    const recs=groups[title];
    const d=parseDateStr(recs[0].Date);
    const sec=document.createElement('section');

    const h=document.createElement('h2');
    h.textContent=`${title} ‚Äî ${d.toLocaleDateString('en-GB')}`;
    sec.appendChild(h);

    const btn=document.createElement('button');
    btn.textContent='Print PDF';
    btn.className='print-btn';
    btn.onclick=()=>{
      document.querySelectorAll('.print-target').forEach(e=>e.classList.remove('print-target'));
      sec.classList.add('print-target');
      window.print();
    };
    sec.appendChild(btn);

    const t=document.createElement('table');
    const isStable=title.toLowerCase().includes('stableford');
    t.innerHTML=`<thead><tr>
      <th>Competition</th><th>Position</th><th>Name</th>
      <th>${isStable?'Stableford':'Score'}</th><th>Points</th><th>Trophy</th>
    </tr></thead>`;
    const tb=document.createElement('tbody');

    recs.sort((a,b)=>a.Position-b.Position).forEach(r=>{
      const pos=parseInt(r.Position);
      const trophy=pos==1?'üèÜ':pos==2?'ü•à':pos==3?'ü•â':'';
      tb.innerHTML+=`<tr>
        <td>${r.Competition||''}</td>
        <td>${r.Position}</td>
        <td>${r.Name||''}</td>
        <td>${isStable?r['Stableford Points']||0:r.Score||''}</td>
        <td>${r.Points||''}</td>
        <td>${trophy}</td>
      </tr>`;
    });

    t.appendChild(tb);
    sec.appendChild(t);
    c.appendChild(sec);
  });
}
</script>

</body>
</html>
